<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ°è´§æƒ…å†µè®°å½•è¡¨</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: #2980b9;
        }
        
        .export-btn {
            background: #27ae60;
        }
        
        .export-btn:hover {
            background: #229954;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            background: white;
        }
        
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        th {
            background: #3498db;
            color: white;
            font-weight: bold;
            position: sticky;
            top: 0;
        }
        
        tr:nth-child(even) {
            background: #f8f9fa;
        }
        
        tr:hover {
            background: #e8f4f8;
        }
        
        input, select {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 12px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 5px rgba(52, 152, 219, 0.3);
        }
        
        .status-pending { background-color: #fff3cd; }
        .status-received { background-color: #d4edda; }
        .status-used { background-color: #f8d7da; }
        
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #e8f6f3;
            border-radius: 5px;
            border-left: 4px solid #27ae60;
        }
        
        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .delete-btn:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¦ è´§ç‰©åˆ°è´§æƒ…å†µè®°å½•è¡¨</h1>
        
        <div class="controls">
            <button onclick="addRow()">â• æ·»åŠ è®°å½•</button>
            <button onclick="exportToCSV()" class="export-btn">ğŸ“„ å¯¼å‡ºCSV</button>
            <button onclick="clearAll()">ğŸ—‘ï¸ æ¸…ç©ºæ•°æ®</button>
        </div>
        
        <table id="deliveryTable">
            <thead>
                <tr>
                    <th>å¿«é€’å•å·</th>
                    <th>å¿«é€’ä»¶æ•°</th>
                    <th>æ”¶è´§æ—¥æœŸ</th>
                    <th>ç‰©å“ç±»å‹</th>
                    <th>è§„æ ¼/å‹å·</th>
                    <th>æ•°é‡</th>
                    <th>å•ä½</th>
                    <th>çŠ¶æ€</th>
                    <th>å·²ä½¿ç”¨æ•°é‡</th>
                    <th>å‰©ä½™æ•°é‡</th>
                    <th>å¤‡æ³¨</th>
                    <th>æ“ä½œ</th>
                </tr>
            </thead>
            <tbody id="tableBody">
                <tr>
                    <td><input type="text" value="SF1234567890" onchange="updateData()"></td>
                    <td><input type="text" value="1/2" onchange="updateData()" placeholder="å¦‚: 1/3"></td>
                    <td><input type="date" value="2025-07-28" onchange="updateData()"></td>
                    <td><input type="text" value="MPOå…‰çº¤è·³çº¿" onchange="updateData()"></td>
                    <td><input type="text" value="12èŠ¯" onchange="updateData()"></td>
                    <td><input type="number" value="10" onchange="updateData()"></td>
                    <td><input type="text" value="æ¡" onchange="updateData()"></td>
                    <td>
                        <select onchange="updateData()">
                            <option value="å·²æ”¶è´§">å·²æ”¶è´§</option>
                            <option value="å¾…æ”¶è´§">å¾…æ”¶è´§</option>
                            <option value="éƒ¨åˆ†ä½¿ç”¨">éƒ¨åˆ†ä½¿ç”¨</option>
                            <option value="å·²ç”¨å®Œ">å·²ç”¨å®Œ</option>
                        </select>
                    </td>
                    <td><input type="number" value="0" onchange="updateData()"></td>
                    <td><input type="number" value="10" readonly></td>
                    <td><input type="text" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                    <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
                </tr>
                <tr>
                    <td><input type="text" value="SF1234567890" onchange="updateData()"></td>
                    <td><input type="text" value="2/2" onchange="updateData()" placeholder="å¦‚: 1/3"></td>
                    <td><input type="date" value="2025-07-28" onchange="updateData()"></td>
                    <td><input type="text" value="LC-LCå…‰çº¤è·³çº¿" onchange="updateData()"></td>
                    <td><input type="text" value="å•æ¨¡" onchange="updateData()"></td>
                    <td><input type="number" value="4" onchange="updateData()"></td>
                    <td><input type="text" value="æ¡" onchange="updateData()"></td>
                    <td>
                        <select onchange="updateData()">
                            <option value="å·²æ”¶è´§">å·²æ”¶è´§</option>
                            <option value="å¾…æ”¶è´§">å¾…æ”¶è´§</option>
                            <option value="éƒ¨åˆ†ä½¿ç”¨">éƒ¨åˆ†ä½¿ç”¨</option>
                            <option value="å·²ç”¨å®Œ">å·²ç”¨å®Œ</option>
                        </select>
                    </td>
                    <td><input type="number" value="0" onchange="updateData()"></td>
                    <td><input type="number" value="4" readonly></td>
                    <td><input type="text" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                    <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
                </tr>
                <tr>
                    <td><input type="text" value="SF0987654321" onchange="updateData()"></td>
                    <td><input type="text" value="1/1" onchange="updateData()" placeholder="å¦‚: 1/3"></td>
                    <td><input type="date" value="2025-07-28" onchange="updateData()"></td>
                    <td><input type="text" value="LC-LCå…‰çº¤è·³çº¿" onchange="updateData()"></td>
                    <td><input type="text" value="å•æ¨¡" onchange="updateData()"></td>
                    <td><input type="number" value="128" onchange="updateData()"></td>
                    <td><input type="text" value="æ¡" onchange="updateData()"></td>
                    <td>
                        <select onchange="updateData()">
                            <option value="å·²æ”¶è´§">å·²æ”¶è´§</option>
                            <option value="å¾…æ”¶è´§">å¾…æ”¶è´§</option>
                            <option value="éƒ¨åˆ†ä½¿ç”¨">éƒ¨åˆ†ä½¿ç”¨</option>
                            <option value="å·²ç”¨å®Œ">å·²ç”¨å®Œ</option>
                        </select>
                    </td>
                    <td><input type="number" value="0" onchange="updateData()"></td>
                    <td><input type="number" value="128" readonly></td>
                    <td><input type="text" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                    <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
                </tr>
                <tr>
                    <td><input type="text" value="SF1122334455" onchange="updateData()"></td>
                    <td><input type="text" value="1/1" onchange="updateData()" placeholder="å¦‚: 1/3"></td>
                    <td><input type="date" value="2025-07-28" onchange="updateData()"></td>
                    <td><input type="text" value="ç½‘çº¿" onchange="updateData()"></td>
                    <td><input type="text" value="CAT6" onchange="updateData()"></td>
                    <td><input type="number" value="67" onchange="updateData()"></td>
                    <td><input type="text" value="æ¡" onchange="updateData()"></td>
                    <td>
                        <select onchange="updateData()">
                            <option value="å·²æ”¶è´§">å·²æ”¶è´§</option>
                            <option value="å¾…æ”¶è´§">å¾…æ”¶è´§</option>
                            <option value="éƒ¨åˆ†ä½¿ç”¨">éƒ¨åˆ†ä½¿ç”¨</option>
                            <option value="å·²ç”¨å®Œ">å·²ç”¨å®Œ</option>
                        </select>
                    </td>
                    <td><input type="number" value="0" onchange="updateData()"></td>
                    <td><input type="number" value="67" readonly></td>
                    <td><input type="text" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                    <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
                </tr>
            </tbody>
        </table>
        
        <div class="summary" id="summary">
            <h3>ğŸ“Š åº“å­˜æ±‡æ€»</h3>
            <div id="summaryData"></div>
        </div>
    </div>

    <script>
        function addRow() {
            const tbody = document.getElementById('tableBody');
            const newRow = tbody.insertRow();
            newRow.innerHTML = `
                <td><input type="text" placeholder="å¿«é€’å•å·" onchange="updateData()"></td>
                <td><input type="text" placeholder="å¦‚: 1/3" onchange="updateData()"></td>
                <td><input type="date" onchange="updateData()"></td>
                <td><input type="text" placeholder="ç‰©å“ç±»å‹" onchange="updateData()"></td>
                <td><input type="text" placeholder="è§„æ ¼/å‹å·" onchange="updateData()"></td>
                <td><input type="number" placeholder="æ•°é‡" onchange="updateData()"></td>
                <td><input type="text" placeholder="å•ä½" onchange="updateData()"></td>
                <td>
                    <select onchange="updateData()">
                        <option value="å¾…æ”¶è´§">å¾…æ”¶è´§</option>
                        <option value="å·²æ”¶è´§">å·²æ”¶è´§</option>
                        <option value="éƒ¨åˆ†ä½¿ç”¨">éƒ¨åˆ†ä½¿ç”¨</option>
                        <option value="å·²ç”¨å®Œ">å·²ç”¨å®Œ</option>
                    </select>
                </td>
                <td><input type="number" value="0" onchange="updateData()"></td>
                <td><input type="number" readonly></td>
                <td><input type="text" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
            `;
            updateData();
        }

        function deleteRow(btn) {
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
                const row = btn.parentNode.parentNode;
                row.parentNode.removeChild(row);
                updateData();
            }
        }

        function updateData() {
            const tbody = document.getElementById('tableBody');
            const rows = tbody.getElementsByTagName('tr');
            
            // æ›´æ–°å‰©ä½™æ•°é‡
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const totalQty = parseInt(cells[5].querySelector('input').value) || 0;
                const usedQty = parseInt(cells[8].querySelector('input').value) || 0;
                const remainingQty = totalQty - usedQty;
                cells[9].querySelector('input').value = remainingQty;
                
                // æ ¹æ®çŠ¶æ€è®¾ç½®è¡Œé¢œè‰²
                const status = cells[7].querySelector('select').value;
                rows[i].className = '';
                if (status === 'å¾…æ”¶è´§') rows[i].className = 'status-pending';
                else if (status === 'å·²æ”¶è´§') rows[i].className = 'status-received';
                else if (status === 'å·²ç”¨å®Œ') rows[i].className = 'status-used';
            }
            
            updateSummary();
            saveData();
        }

        function saveData() {
            const tbody = document.getElementById('tableBody');
            const rows = tbody.getElementsByTagName('tr');
            const data = [];
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const rowData = [];
                
                // è·å–æ‰€æœ‰inputå’Œselectçš„å€¼ï¼ˆé™¤äº†æœ€åçš„æ“ä½œåˆ—ï¼‰
                for (let j = 0; j < cells.length - 1; j++) {
                    const input = cells[j].querySelector('input, select');
                    if (input) {
                        rowData.push(input.value);
                    }
                }
                data.push(rowData);
            }
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼Œä½¿ç”¨JSONæ ¼å¼
            try {
                const dataString = JSON.stringify(data);
                // ä½¿ç”¨å†…å­˜å˜é‡æ¨¡æ‹Ÿå­˜å‚¨
                window.deliveryData = dataString;
            } catch (e) {
                console.log('æ•°æ®ä¿å­˜å¤±è´¥:', e);
            }
        }

        function loadData() {
            try {
                // ä»å†…å­˜å˜é‡è¯»å–æ•°æ®
                const savedData = window.deliveryData;
                if (savedData) {
                    const data = JSON.parse(savedData);
                    const tbody = document.getElementById('tableBody');
                    tbody.innerHTML = '';
                    
                    data.forEach(rowData => {
                        const newRow = tbody.insertRow();
                        newRow.innerHTML = `
                            <td><input type="text" value="${rowData[0] || ''}" onchange="updateData()"></td>
                            <td><input type="text" value="${rowData[1] || ''}" placeholder="å¦‚: 1/3" onchange="updateData()"></td>
                            <td><input type="date" value="${rowData[2] || ''}" onchange="updateData()"></td>
                            <td><input type="text" value="${rowData[3] || ''}" onchange="updateData()"></td>
                            <td><input type="text" value="${rowData[4] || ''}" onchange="updateData()"></td>
                            <td><input type="number" value="${rowData[5] || ''}" onchange="updateData()"></td>
                            <td><input type="text" value="${rowData[6] || ''}" onchange="updateData()"></td>
                            <td>
                                <select onchange="updateData()">
                                    <option value="å¾…æ”¶è´§" ${rowData[7] === 'å¾…æ”¶è´§' ? 'selected' : ''}>å¾…æ”¶è´§</option>
                                    <option value="å·²æ”¶è´§" ${rowData[7] === 'å·²æ”¶è´§' ? 'selected' : ''}>å·²æ”¶è´§</option>
                                    <option value="éƒ¨åˆ†ä½¿ç”¨" ${rowData[7] === 'éƒ¨åˆ†ä½¿ç”¨' ? 'selected' : ''}>éƒ¨åˆ†ä½¿ç”¨</option>
                                    <option value="å·²ç”¨å®Œ" ${rowData[7] === 'å·²ç”¨å®Œ' ? 'selected' : ''}>å·²ç”¨å®Œ</option>
                                </select>
                            </td>
                            <td><input type="number" value="${rowData[8] || '0'}" onchange="updateData()"></td>
                            <td><input type="number" value="${rowData[9] || ''}" readonly></td>
                            <td><input type="text" value="${rowData[10] || ''}" placeholder="å¤‡æ³¨ä¿¡æ¯" onchange="updateData()"></td>
                            <td><button class="delete-btn" onclick="deleteRow(this)">åˆ é™¤</button></td>
                        `;
                    });
                    
                    updateData();
                    return true;
                }
            } catch (e) {
                console.log('æ•°æ®åŠ è½½å¤±è´¥:', e);
            }
            return false;
        }

        function updateSummary() {
            const tbody = document.getElementById('tableBody');
            const rows = tbody.getElementsByTagName('tr');
            const summary = {};
            
            for (let i = 0; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                const itemType = cells[3].querySelector('input').value;
                const totalQty = parseInt(cells[5].querySelector('input').value) || 0;
                const usedQty = parseInt(cells[8].querySelector('input').value) || 0;
                const remainingQty = totalQty - usedQty;
                const unit = cells[6].querySelector('input').value;
                
                if (itemType && totalQty > 0) {
                    if (!summary[itemType]) {
                        summary[itemType] = { total: 0, used: 0, remaining: 0, unit: unit };
                    }
                    summary[itemType].total += totalQty;
                    summary[itemType].used += usedQty;
                    summary[itemType].remaining += remainingQty;
                }
            }
            
            let summaryHTML = '';
            for (const [type, data] of Object.entries(summary)) {
                summaryHTML += `
                    <p><strong>${type}:</strong> 
                    æ€»é‡ ${data.total} ${data.unit} | 
                    å·²ç”¨ ${data.used} ${data.unit} | 
                    å‰©ä½™ ${data.remaining} ${data.unit}
                    </p>
                `;
            }
            
            if (summaryHTML === '') {
                summaryHTML = '<p>æš‚æ— æ•°æ®</p>';
            }
            
            document.getElementById('summaryData').innerHTML = summaryHTML;
        }

        function exportToCSV() {
            const table = document.getElementById('deliveryTable');
            const rows = table.querySelectorAll('tr');
            let csv = [];
            
            // è·å–è¡¨å¤´
            const headers = [];
            rows[0].querySelectorAll('th').forEach(th => {
                if (th.textContent !== 'æ“ä½œ') {
                    headers.push(th.textContent);
                }
            });
            csv.push(headers.join(','));
            
            // è·å–æ•°æ®è¡Œ
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const rowData = [];
                const inputs = row.querySelectorAll('input, select');
                
                for (let j = 0; j < inputs.length - 1; j++) { // æ’é™¤æœ€åçš„æ“ä½œåˆ—
                    let value = inputs[j].value || '';
                    if (value.includes(',')) {
                        value = `"${value}"`;
                    }
                    rowData.push(value);
                }
                csv.push(rowData.join(','));
            }
            
            // ä¸‹è½½CSVæ–‡ä»¶
            const csvContent = csv.join('\n');
            const blob = new Blob(['\ufeff' + csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'è´§ç‰©åˆ°è´§è®°å½•_' + new Date().toISOString().slice(0, 10) + '.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
                document.getElementById('tableBody').innerHTML = '';
                window.deliveryData = null; // æ¸…ç©ºä¿å­˜çš„æ•°æ®
                updateData();
            }
        }

        // é¡µé¢åŠ è½½æ—¶åŠ è½½ä¿å­˜çš„æ•°æ®
        window.onload = function() {
            // å…ˆå°è¯•åŠ è½½ä¿å­˜çš„æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä½¿ç”¨é»˜è®¤æ•°æ®
            if (!loadData()) {
                updateData(); // ä½¿ç”¨é»˜è®¤çš„é¢„å¡«æ•°æ®
            }
        };
    </script>
</body>
</html>
