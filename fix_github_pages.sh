#!/bin/bash

echo "ğŸš€ å¼€å§‹è‡ªåŠ¨ä¿®å¤ GitHub Pages é—®é¢˜..."

# 1. è§£å†³ Jekyll è¿‡æ»¤é—®é¢˜ (404 æ€æ‰‹)
if [ ! -f .nojekyll ]; then
    echo "âœ… åˆ›å»º .nojekyll æ–‡ä»¶..."
    touch .nojekyll
else
    echo "â„¹ï¸ .nojekyll å·²å­˜åœ¨"
fi

# 2. åˆ é™¤å­æ¨¡å—é…ç½®æ–‡ä»¶
if [ -f .gitmodules ]; then
    echo "ğŸ—‘ï¸ æ£€æµ‹åˆ° .gitmodulesï¼Œæ­£åœ¨åˆ é™¤..."
    rm .gitmodules
fi

# 3. æš´åŠ›æ¸…ç†ï¼šæŸ¥æ‰¾å¹¶åˆ é™¤æ‰€æœ‰å­æ–‡ä»¶å¤¹é‡Œçš„ .git ç›®å½•
# (é˜²æ­¢æ–‡ä»¶å¤¹è¢«è¯¯è¯†åˆ«ä¸ºå­æ¨¡å—ï¼Œä¿ç•™æ ¹ç›®å½•çš„ .git)
echo "ğŸ§¹ æ‰«æå¹¶æ¸…ç†åµŒå¥—çš„ .git æ–‡ä»¶å¤¹..."
find . -mindepth 2 -type d -name ".git" -exec rm -rf {} +
echo "âœ… åµŒå¥— .git æ¸…ç†å®Œæ¯•"

# 4. æ ¸å¼¹çº§é‡ç½®ç´¢å¼• (è¿™æ˜¯æœ€å…³é”®çš„ä¸€æ­¥)
# è¿™ä¸€æ­¥ä¼šæŠŠæ‰€æœ‰æ–‡ä»¶ä» Git è®°å½•ä¸­ç§»é™¤(ä¸åˆ æ–‡ä»¶)ï¼Œç„¶åé‡æ–°æ·»åŠ 
# è¿™æ ·èƒ½å¼ºåˆ¶æŠŠä¹‹å‰çš„â€œå­æ¨¡å—â€é‡æ–°è¯†åˆ«ä¸ºâ€œæ™®é€šæ–‡ä»¶å¤¹â€
echo "ğŸ”„ é‡ç½® Git ç´¢å¼• (è¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿ)..."
git rm -r --cached . > /dev/null 2>&1

# 5. é‡æ–°æ·»åŠ æ‰€æœ‰æ–‡ä»¶
echo "â• é‡æ–°æ·»åŠ æ‰€æœ‰æ–‡ä»¶..."
git add .

# 6. æäº¤å¹¶æ¨é€
echo "ğŸ“¦ æäº¤æ›´æ”¹..."
git commit -m "Auto-fix: Flatten submodules and add .nojekyll for GitHub Pages"

echo "ğŸš€ æ¨é€åˆ° GitHub..."
git push

echo "ğŸ‰ ä¿®å¤å®Œæˆï¼è¯·å» GitHub Actions æŸ¥çœ‹æ„å»ºçŠ¶æ€ã€‚"
